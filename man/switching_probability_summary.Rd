% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/switching_probability_summary.R
\name{switching_probability_summary}
\alias{switching_probability_summary}
\alias{print.switching_summary}
\alias{summary.switching_summary}
\alias{plot.switching_summary}
\title{Compute switching-probability summary}
\usage{
switching_probability_summary(
  df,
  covariates = NULL,
  scale = c("mass", "hazard")
)

\method{print}{switching_summary}(x, ...)

\method{summary}{switching_summary}(object, ...)

\method{plot}{switching_summary}(x, type = c("boxplot", "line"), ...)
}
\arguments{
\item{df}{A \code{data.frame} (e.g., from \code{preprocess_data()}) containing at least
a subject id, a time index, and a binary treatment indicator.}

\item{scale}{Character, \code{"mass"} (default) or \code{"hazard"}. See Details.}

\item{x}{an object used to select a method.}

\item{...}{Passed to \code{ggplot2::geom_boxplot()} when \code{type="boxplot"}.}

\item{object}{A \code{switching_summary} object.}

\item{type}{One of \code{"boxplot"} (per-interval boxplots of per-subject
indicators with mean ± 95\% Wald bars overlaid) or \code{"line"} (mean curve with
95\% ribbon). Defaults to \code{"boxplot"}.}
}
\value{
An object of class \code{switching_summary}, a list with components:
\describe{
\item{by_k}{A data frame with one row per interval containing:
k_idx, n (at-risk sample size), mean_p (mean
probability on the chosen scale), Wald 95\% limits lo95/hi95,
and q25}/q50/q75 for descriptive dispersion.}
\item{by_id_k}{Per-subject indicators used for boxplots:
for scale="hazard", it is the 0/1 indicator of switching at \(k\)
among the at-risk set; for scale="mass", it is the 0/1 indicator of
“first switch occurs at \(k\)”.}
\item{id_col,time_col,treat_col,death_col}{Resolved column names.}
\item{scale}{The scale used ("mass" or "hazard").}
}
}
\description{
Summarize how often subjects switch (initiate) treatment across follow-up
intervals. Two complementary scales are supported:
\itemize{
\item mass (default): the marginal probability of initiating at interval \(k\),
i.e., the proportion of the cohort that switches exactly at \(k\).
\item hazard: the conditional probability of switching at interval \(k\)
given the subject has not switched before \(k\).
}

In discrete time these satisfy \(m(k) = S(k-1)\,h(k)\), where \(h(k)\) is the
hazard and \(S(k-1)\) the probability of not yet switched before \(k\).
}
\details{
Let \(A_{i,k}\) be subject \(i\)'s treatment at interval \(k\) and define
\(R_{i,k}=\mathbf{1}\{\text{subject }i\text{ is alive and }k>1\}\). The event
of switching at \(k\) is \(E_{i,k}=\mathbf{1}\{A_{i,k}\neq A_{i,k-1}\}\).
\itemize{
\item \strong{Hazard scale}: \(h(k)=\mathbb{E}(E_{i,k}\mid R_{i,k}=1)\),
estimated by the at-risk mean of \(E_{i,k}\) at each \(k\).
\item \strong{Mass scale}: \(m(k)=\mathbb{P}(\text{first switch at }k)\),
estimated as the cohort mean of the first-switch indicator; this is
numerically equivalent to \(S(k\!-\!1)\,h(k)\) with \(S(k\!-\!1)\) the
product over \(j<k\) of \((1-h(j))\).
}
The summary is purely descriptive (nonparametric) and does not fit a model;
it is intended to contextualize causal estimates and reveal time-structured
policies (e.g., delayed initiation or systematic stopping).
}
\section{Functions}{
\itemize{
\item \code{print(switching_summary)}: Print the interval-level summary table.

\item \code{summary(switching_summary)}: Summary the interval-level summary table

\item \code{plot(switching_summary)}: Plot switching summaries across intervals.

}}
\examples{
\dontrun{
# default: marginal "mass" scale
sw <- switching_probability_summary(fit$data_preprocessed)
plot(sw, type = "boxplot")

# conditional hazard view
sw_h <- switching_probability_summary(fit$data_preprocessed, scale = "hazard")
plot(sw_h, type = "line")
}

}
