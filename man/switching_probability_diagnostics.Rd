% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/probability_diagnosis.R
\name{switching_probability_diagnostics}
\alias{switching_probability_diagnostics}
\title{Diagnostics for Discrete-Time Switching Probability}
\usage{
switching_probability_diagnostics(
  df,
  covariates = NULL,
  save_plots = FALSE,
  plot_prefix = "switch_"
)
}
\arguments{
\item{df}{A pre-processed data frame from \code{\link{preprocess_data}}
containing at least \code{pat_id}, \code{k_idx}, \code{A} and any covariates.}

\item{covariates}{Character vector of covariate names to include, or \code{NULL}.}

\item{save_plots}{Logical; if \code{TRUE}, saves the plot as PNG.}

\item{plot_prefix}{File-name prefix when saving the plot.}
}
\value{
A list with components:
\describe{
\item{summary}{Data frame of mean / median / 5-95 \% quantiles of switching probability by interval.}
\item{plot}{A \code{ggplot} box-plot object.}
\item{model}{The fitted \code{glm} object.}
}
}
\description{
Fits a discrete-time logistic-hazard model for treatment switching,
computes interval-specific switching probabilities, and visualises diagnostics.
}
\details{
The function fits a logistic regression for the hazard of switching in each
discrete interval, predicts subject-level probabilities, summarises them,
and (optionally) writes a PNG of the diagnostic box-plot.
}
\examples{
\dontrun{
prep <- preprocess_data(
  data.frame(
    id = rep(1:3, each = 2), k = rep(1:2, 3),
    Y = sample(0:2, 6, TRUE),
    T = rbinom(6, 1, 0.1),
    C = rbinom(6, 1, 0.05),
    A = rbinom(6, 1, 0.5),
    X = rnorm(6)
  ),
  id_col = "id", k_col = "k", y_col = "Y",
  t_col = "T", c_col = "C", a_col = "A",
  x_cols = "X", K = 2
)
res <- switching_probability_diagnostics(prep$processed_df)
res$plot
}

}
